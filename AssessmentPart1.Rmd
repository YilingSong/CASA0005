---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
plot(cars)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).
```{r}
getwd()
library(maptools)
library(RColorBrewer)
library(classInt)
library(OpenStreetMap)
library(sp)
library(rgeos)
library(tmap)
library(tmaptools)
library(sf)
library(rgdal)
library(geojsonio)
BoroughMapE<-read_shape("HW/englandBoundaryData/england_ct_2011.shp", as.sf= TRUE)
qtm(BoroughMapE)
Populationdata<-read.csv("HW/birthpercentage.csv")
library(methods)
class(BoroughMapE)
BoroughMapE<-append_data(BoroughMapE, Populationdata, key.shp = "code", key.data = "Code", ignore.duplicates = TRUE)                         
library(tmap)
library(tmaptools)
tmap_mode("plot")
tmap_options(max.categories = 5)
qtm(BoroughMapE, fill = "Ratio")
#MAP
England_osm <- read_osm(BoroughMapE, type = "esri", zoom = NULL)
qtm(England_osm) + 
  tm_shape(BoroughMapE) + 
  tm_polygons("Ratio", 
        style="fixed",
        palette="PuBu",
        midpoint=NA,
        title="Asian birth rate /Non-UK in England",
        alpha = 0.5) + 
  tm_compass(position = c("left", "bottom"),type = "arrow") + 
  tm_scale_bar(position = c("left", "bottom")) +
  tm_layout(title = "Birth Ratio of Asian and Non-UK Residents in England", legend.position = c("left", "bottom"))

#GIS
library(raster)
library(rgdal)
my_img<-raster("Hw/cw_gis.jpg")
plot(my_img)
```
For GIS map, it was generated by a shape file with London boundary, railway station points and railway (Geofabrik), and a csv file with population data of London boroughs (Data London). It found that shapefile has deficiency of some railway station points, reducing the reliability of data. For R based map, it also contains a shapefile of England counties boundary data (Edina census), and a csv file of birth rate (ons.gov.uk). Compared with London data, England counties data was much difficult to collect and faced problems with missing data.

For GIS map, by using buffer(500m), it represented that the railway system service is concentrated in the centre of London where is high coverage of railway stations. However, most dwellers live in suburb area, which reflecting the commuting problems in London. By comparison, the R map analyzed the single variable, and simply displayed the birth rate of Asian in different England counties.

Firstly, to get railway station and railway station point layer, the base shapefiles were selected by the attributes separately. Additionally, in order to plainly compare the population in different boroughs, London boundary shp was joined with the London census data(csv) by code and symbolized with "population" value by using "quantities". Finally, to analyze the coverage of railway system service, it used buffer (500 meters walking distance) to station point. 

In terms of R, it starts with loading packages, and then read the shapefile and plot it using the base plot function. After checking the data, the base map was joined csv data with "code" factor. To make a choropleth map, it used tmap to fill the variable and plot map. In the end, adjust the legend, title, style and palette. 

